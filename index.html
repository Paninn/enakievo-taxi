<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–∫—Å–∏ –ï–Ω–∞–∫–∏–µ–≤–æ & –ì–æ—Ä–ª–æ–≤–∫–∞ üöï</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        :root {
            --primary: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            --glass: rgba(255, 255, 255, 0.12);
            --glass-hover: rgba(255, 255, 255, 0.22);
            --accent: #4ecdc4;
            --neon: #00ffea;
            --danger: #ff6b6b;
            --shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro', system-ui, sans-serif;
            background: var(--primary);
            color: white;
            min-height: 100vh;
            position: relative;
        }

        /* –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è —Å–ø—Ä–∞–≤–∞ —Å–≤–µ—Ä—Ö—É */
        #profileBtn {
            position: fixed; top: 20px; right: 20px; z-index: 1000;
            background: var(--glass); backdrop-filter: blur(20px);
            border: none; border-radius: 50%; width: 60px; height: 60px;
            font-size: 32px; cursor: pointer;
            box-shadow: var(--shadow); transition: all 0.4s;
        }
        #profileBtn:hover { transform: scale(1.1); box-shadow: 0 0 30px var(--neon); }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è */
        #profileModal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); z-index: 999;
            justify-content: center; align-items: center; animation: fadeIn 0.4s;
        }
        .modal-content {
            background: var(--glass); backdrop-filter: blur(30px);
            border-radius: 28px; padding: 30px; max-width: 90%; width: 400px;
            box-shadow: 0 30px 80px rgba(0,0,0,0.5); text-align: center;
            animation: slideUp 0.5s;
        }
        .closeBtn { position: absolute; top: 15px; right: 20px; font-size: 30px; cursor: pointer; }

        .container { max-width: 420px; margin: 0 auto; padding: 20px; padding-top: 90px; }

        .header { text-align: center; padding: 20px 0; animation: slideDown 0.8s; }
        h1 { font-size: 36px; margin-bottom: 10px; text-shadow: 0 0 20px var(--neon); }

        .glass-card {
            background: var(--glass); backdrop-filter: blur(25px);
            border-radius: 24px; padding: 28px; margin: 20px 0;
            border: 1px solid rgba(255,255,255,0.2); box-shadow: var(--shadow);
            transition: all 0.4s; animation: fadeInUp 0.6s;
        }
        .glass-card:hover { transform: translateY(-6px); background: var(--glass-hover); }

        input {
            width: 100%; padding: 20px 24px; margin: 12px 0;
            background: rgba(255,255,255,0.15); border: 2px solid transparent;
            border-radius: 20px; font-size: 18px; color: white;
            transition: all 0.3s;
        }
        input:focus { border-color: var(--neon); box-shadow: 0 0 20px rgba(0,255,234,0.3); }
        input.error { border-color: var(--danger); animation: shake 0.5s; }

        .btn {
            width: 100%; padding: 22px; margin: 16px 0; border: none;
            border-radius: 20px; font-size: 20px; font-weight: 600;
            cursor: pointer; position: relative; overflow: hidden;
            background: linear-gradient(135deg, var(--accent), #45b7a3);
        }
        .btn::after { content: ''; position: absolute; top: 50%; left: 50%;
            width: 0; height: 0; background: rgba(255,255,255,0.3);
            border-radius: 50%; transform: translate(-50%,-50%); transition: all 0.6s;
        }
        .btn:active::after { width: 300px; height: 300px; }

        #priceCard { font-size: 28px; text-align: center; min-height: 100px; display: flex; flex-direction: column; justify-content: center; }

        .orders-list { max-height: 300px; overflow-y: auto; gap: 12px; display: grid; }
        .order-item { background: rgba(255,255,255,0.08); padding: 16px; border-radius: 16px; border-left: 5px solid var(--neon); }

        @keyframes slideDown { from { opacity: 0; transform: translateY(-40px); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(40px); } }
        @keyframes fadeIn { from { opacity: 0; } }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } }
        @keyframes shake { 0%,100% { transform: translateX(0); } 10%,30%,50%,70%,90% { transform: translateX(-10px); } 20%,40%,60%,80% { transform: translateX(10px); } }
    </style>
</head>
<body>
    <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
    <button id="profileBtn" onclick="openProfile()">üë§</button>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div id="profileModal" onclick="if(event.target===this) closeProfile()">
        <div class="modal-content">
            <span class="closeBtn" onclick="closeProfile()">√ó</span>
            <h2 style="margin-bottom:20px; text-shadow: 0 0 15px var(--neon);">–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
            <p style="font-size:24px; margin:15px 0;"><strong id="modalName"></strong></p>
            <p style="font-family:monospace; font-size:16px; opacity:0.8;">ID: <span id="modalId"></span></p>
            <p style="font-size:20px; margin:20px 0;">–ó–∞–∫–∞–∑–æ–≤: <strong id="modalOrders">0</strong></p>
            <div style="background:rgba(255,255,255,0.1); padding:15px; border-radius:16px; margin-top:20px;">
                üöï –¢–∞–∫—Å–∏ –ï–Ω–∞–∫–∏–µ–≤–æ & –ì–æ—Ä–ª–æ–≤–∫–∞<br>
                üí∞ –ù–∞–ª–∏—á–∫–æ–π –≤–æ–¥–∏—Ç–µ–ª—é
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üöï –¢–∞–∫—Å–∏ –ï–Ω–∞–∫–∏–µ–≤–æ ‚Äî –ì–æ—Ä–ª–æ–≤–∫–∞</h1>
            <p style="opacity:0.9;">–ë—ã—Å—Ç—Ä–æ ‚Ä¢ –ù–∞–¥—ë–∂–Ω–æ ‚Ä¢ –ü–æ –î–ù–†</p>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ -->
        <div class="glass-card">
            <h3 style="margin-bottom:20px;">üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h3>
            <div class="orders-list" id="ordersList">
                <div style="text-align:center; opacity:0.6; padding:40px;">–ò—Å—Ç–æ—Ä–∏—è –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞</div>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞ -->
        <div class="glass-card">
            <h3 style="margin-bottom:20px;">üìç –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h3>
            
            <input type="text" id="from" placeholder="–û—Ç–∫—É–¥–∞: —É–ª. –õ–µ–Ω–∏–Ω–∞, –í–∞—Ç—É—Ç–∏–Ω–∞, –ì–æ—Ä–ª–æ–≤—Å–∫–∞—è –î–∏–≤–∏–∑–∏—è...">
            <input type="text" id="to" placeholder="–ö—É–¥–∞: —É–ª. –ú–µ—Ç–∞–ª–ª—É—Ä–≥–æ–≤, –¶–µ–Ω—Ç—Ä –ì–æ—Ä–ª–æ–≤–∫–∏, –†—É–¥–∞–∫–æ–≤–∞...">
            <input type="tel" id="phone" placeholder="üì± +7949... –∏–ª–∏ 071-...">
            <input type="text" id="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ø–∞—Å—Å–∞–∂–∏—Ä—ã, –±–∞–≥–∞–∂...)">

            <div id="priceCard" class="glass-card" style="margin:20px 0;">
                –í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å–∞ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞
            </div>

            <button class="btn" onclick="calculatePrice()" id="calcBtn">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ü–µ–Ω—É</button>
            <button class="btn" onclick="sendOrder()" id="orderBtn" style="display:none;">‚úÖ –ó–∞–∫–∞–∑–∞—Ç—å —Ç–∞–∫—Å–∏</button>
        </div>
    </div>

    <script>
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        Telegram.WebApp.MainButton.setText("üöÄ –ó–∞–∫–∞–∑–∞—Ç—å").setParams({color: '#4ecdc4'}).hide().onClick(sendOrder);

        const user = Telegram.WebApp.initDataUnsafe.user;
        const orders = JSON.parse(localStorage.getItem('orders_dnr') || '[]');

        // –ë–æ–ª—å—à–æ–π —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ (–ï–Ω–∞–∫–∏–µ–≤–æ + –ø–æ—Å. –í–∞—Ç—É—Ç–∏–Ω–∞ + –ì–æ—Ä–ª–æ–≤–∫–∞)
        const KEYWORDS = [
            // –ï–Ω–∞–∫–∏–µ–≤–æ
            '–ª–µ–Ω–∏–Ω–∞', '–º–µ—Ç–∞–ª–ª—É—Ä–≥–æ–≤', '–±–µ—Ä–µ–≥–æ–≤–æ–≥–æ', '–≥–æ—Ä–Ω—è–∫–æ–≤', '–∑–∞–±–æ–π—â–∏–∫–æ–≤', '—Ç–∏—É–Ω–æ–≤–∞', '—Å–æ–≤–µ—Ç—Å–∫–∞—è', '–º–∏—Ä–∞', '–æ–∫—Ç—è–±—Ä—å—Å–∫–∞—è',
            '–∫–∏—Ä–æ–≤–∞', '–≥–∞–≥–∞—Ä–∏–Ω–∞', '–ø—É—à–∫–∏–Ω–∞', '—à–µ–≤—á–µ–Ω–∫–æ', '–≤–∞—Ç—É—Ç–∏–Ω–∞', '—Å–µ–≤–µ—Ä–Ω—ã–π', '—é–∂–Ω—ã–π', '—Ü–µ–Ω—Ç—Ä', '—Ä—ã–Ω–æ–∫', '–∞–≤—Ç–æ–≤–æ–∫–∑–∞–ª',
            '–ø–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞', '–±–æ–ª—å–Ω–∏—Ü–∞', '–∂/–¥ –≤–æ–∫–∑–∞–ª', '—à–∫–æ–ª–∞', '–º–∞–≥–Ω–∏—Ç', '–ø—è—Ç–µ—Ä–æ—á–∫–∞', '–∞—Ç–±',
            // –ì–æ—Ä–ª–æ–≤–∫–∞
            '–≥–æ—Ä–ª–æ–≤—Å–∫–æ–π –¥–∏–≤–∏–∑–∏–∏', '—Ä—É–¥–∞–∫–æ–≤–∞', '–∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è', '–ø–µ—Ä–≤–æ–º–∞–π—Å–∫–∞—è', '–æ—Å—Ç–∞–ø–µ–Ω–∫–∞', '–ø—É—à–∫–∏–Ω—Å–∫–∞—è', '–º–∞—Ç—Ä–æ—Å–æ–≤–∞',
            '—á–µ—Ä–Ω–∏–∫–æ–≤–∞', '–∫–∞–ª–∏–Ω–∏–Ω—Å–∫–∏–π', '–Ω–∏–∫–∏—Ç–æ–≤—Å–∫–∏–π', '—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ-–≥–æ—Ä–æ–¥—Å–∫–æ–π', '—Å—Ç—Ä–æ–π', '–∫–æ–º—Å–æ–º–æ–ª—å—Å–∫', '—Å—Ç–∞—Ä–∞—Ç–µ–ª—å'
        ];

        // –ü—Ä–æ—Ñ–∏–ª—å
        document.getElementById('modalName').textContent = user.first_name + (user.last_name ? ' ' + user.last_name : '');
        document.getElementById('modalId').textContent = user.id;
        document.getElementById('modalOrders').textContent = orders.length;

        function openProfile() {
            document.getElementById('profileModal').style.display = 'flex';
            document.getElementById('modalOrders').textContent = orders.length;
        }
        function closeProfile() {
            document.getElementById('profileModal').style.display = 'none';
        }

        function isValidAddress(address) {
            if (!address) return false;
            const lower = address.toLowerCase().replace(/[^\w\s]/g, ' ').trim();
            return KEYWORDS.some(kw => lower.includes(kw));
        }

        function validatePhone(phone) {
            const cleaned = phone.replace(/\D/g, '');
            return cleaned.length >= 10 && ['7', '380', '071', '949'].some(prefix => cleaned.startsWith(prefix));
        }

        function calculatePrice() {
            const from = document.getElementById('from').value.trim();
            const to = document.getElementById('to').value.trim();
            const phone = document.getElementById('phone').value.trim();

            document.querySelectorAll('input').forEach(el => el.classList.remove('error'));
            let errorMsg = '';

            if (!from || !isValidAddress(from)) { document.getElementById('from').classList.add('error'); errorMsg += '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∞–¥—Ä–µ—Å "–û—Ç–∫—É–¥–∞"<br>'; }
            if (!to || !isValidAddress(to)) { document.getElementById('to').classList.add('error'); errorMsg += '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∞–¥—Ä–µ—Å "–ö—É–¥–∞"<br>'; }
            if (!phone || !validatePhone(phone)) { document.getElementById('phone').classList.add('error'); errorMsg += '‚ùå –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω<br>'; }

            if (errorMsg) {
                document.getElementById('priceCard').innerHTML = errorMsg;
                document.getElementById('orderBtn').style.display = 'none';
                Telegram.WebApp.MainButton.hide();
                return;
            }

            // –¶–µ–Ω–∞: –ø–æ –≥–æ—Ä–æ–¥—É 150-350, –º–µ–∂–≥–æ—Ä–æ–¥ +400-600
            let price = 200;
            if ((from.toLowerCase().includes('–≥–æ—Ä–ª–æ–≤–∫') || to.toLowerCase().includes('–≥–æ—Ä–ª–æ–≤–∫')) &&
                !(from.toLowerCase().includes('–≥–æ—Ä–ª–æ–≤–∫') && to.toLowerCase().includes('–≥–æ—Ä–ª–æ–≤–∫'))) {
                price += 500;
            }
            price += Math.floor(Math.random() * 200);

            document.getElementById('priceCard').innerHTML = `
                üí∞ <strong>${price} ‚ÇΩ</strong> –Ω–∞–ª–∏—á–∫–æ–π<br>
                <small>‚è±Ô∏è 10‚Äì40 –º–∏–Ω –≤ –ø—É—Ç–∏</small>
            `;

            document.getElementById('calcBtn').style.display = 'none';
            document.getElementById('orderBtn').style.display = 'block';
            Telegram.WebApp.MainButton.show();
        }

        function sendOrder() {
            const price = document.getElementById('priceCard').textContent.match(/\d+/)[0];
            const orderData = {
                from: document.getElementById('from').value.trim(),
                to: document.getElementById('to').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                comment: document.getElementById('comment').value.trim(),
                price: price,
                time: new Date().toLocaleString('ru-RU')
            };

            orders.unshift(orderData);
            localStorage.setItem('orders_dnr', JSON.stringify(orders.slice(0, 50)));
            showOrders();

            Telegram.WebApp.sendData(JSON.stringify(orderData));
            Telegram.WebApp.close();
        }

        function showOrders() {
            const list = document.getElementById('ordersList');
            if (orders.length === 0) return;

            list.innerHTML = orders.slice(0, 5).map(o => `
                <div class="order-item">
                    <div style="font-size:14px; opacity:0.8;">${o.time}</div>
                    <div style="font-size:18px; font-weight:600;">${o.from} ‚Üí ${o.to}</div>
                    <div style="font-size:20px; color:var(--neon);">üí∞ ${o.price} ‚ÇΩ</div>
                </div>
            `).join('');
        }

        showOrders();
    </script>
</body>
</html>
